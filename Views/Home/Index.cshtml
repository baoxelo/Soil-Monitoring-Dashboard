@model Soil_Monitoring_Web_App.Models.SoilData


@{
    ViewData["Title"] = "Home Page";
}

<div class="position-relative row px-5 py-3 d-flex justify-content-center">

    <!-- Interact DB -->
    <div class="crudDb-container">
        <form asp-action="RefreshData" method="post" class="updatedb-btn position-relative">
            <svg class="position-absolute h-100 w-100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <radialGradient id="greenFade" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" stop-color="rgb(221, 239, 150,0)" />
                        <stop offset="100%" stop-color="rgba(221, 239, 150,1)" />
                    </radialGradient>
                </defs>
                <circle cx="30" cy="30" r="30" fill="url(#greenFade)" />
            </svg>
            <button type="submit" class="border-0 bg-transparent" title="Refresh"><i class="fa-solid fa-cloud-arrow-down"></i></button>
        </form>
        <form asp-action="" method="post" class="updatedb-btn position-relative">
            <svg class="position-absolute h-100 w-100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <radialGradient id="greenFade" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" stop-color="rgb(221, 239, 150,0)" />
                        <stop offset="100%" stop-color="rgba(221, 239, 150,1)" />
                    </radialGradient>
                </defs>
                <circle cx="30" cy="30" r="30" fill="url(#greenFade)" />
            </svg>
            <button type="submit" class="border-0 bg-transparent" title="Add"><i class="fa-solid fa-plus"></i></button>
        </form>
    </div>
    <!-- SOIL IMAGE -->

    <div class="d-flex flex-column align-items-center col-xl-6">
        <h1 class="fw-bold">Soil Monitoring </h1>
        <h1 class="fw-bold">Dashboard</h1>

        <div class="soil-container">
            <img src="~/img/leafpng.png" class="d-block soil-image"></>
            <!-- LINE SVG -->
            <svg class="position-absolute" style="top: 0; left: -100px; width: 100%; height: 100%;">
                <!-- PH LINE -->
                <line x1="20" y1="100" x2="130" y2="100"
                      stroke="rgb(118, 160, 110)" stroke-width="1" />
                <line x1="130" y1="100" x2="200" y2="170"
                      stroke="rgb(118, 160, 110)" stroke-width="1" />
                <circle class="position-absolute" cx="200" cy="170" r="8" fill="white" stroke="rgba(128, 128, 128, 0.4)" stroke-width="10" />
                
                
            </svg>
            <svg class="position-absolute" style="top: 0; left: 100px; width: 100%; height: 100%;">
                <!-- EC LINE -->
                <line x1="150" y1="250" x2="250" y2="350"
                      stroke="rgb(118, 160, 110)" stroke-width="1" />
                <line x1="250" y1="350" x2="350" y2="350"
                      stroke="rgb(118, 160, 110)" stroke-width="1" />
                <circle class="position-absolute" cx="150" cy="250" r="8" fill="white" stroke="rgba(128, 128, 128, 0.4)" stroke-width="10" />
            </svg>

            <!-- PH TEXT -->
            <div class="position-absolute text-nowrap" style="top: 50px; left: -80px; ">
                <div>pH Level</div>
                <div class="fw-bold">@Model.PH ±0.2</div>
            </div>
            <!-- EC TEXT -->
            <div class="position-absolute text-nowrap" style="top: 300px; left: 350px;">
                <div>EC Level</div>
                <div class="fw-bold">@Model.EC ±0.2</div>
            </div>
        </div>
    </div>

    <!-- STATISTIC -->
    <div class="d-block col-xl-6">
        <div class="row">
            <div class="col-xl-3 d-flex flex-column">
                <div class="info-card" >
                    <span>Temperature</span>
                    <div class="icon-wrapper"><i class="fa-solid fa-temperature-high"></i></div>
                    <div class="title"> <h2 class="d-inline-block">@Model.Temp </h2>°C</div>
                </div>
                <div class="info-card dark">
                    <span>Moisture</span>
                    <div class="icon-wrapper text-black"><i class="fa-solid fa-droplet"></i></i></div>
                    <div class="title"> <h2 class="d-inline-block">@Model.Moisture </h2>%</div>

                </div>
                <div class="info-card">
                    <span>Location</span>
                    <div class="icon-wrapper"><i class="fa-solid fa-location-dot"></i></i></div>
                    <div class="title">Lat: <h6 class="d-inline-block fw-bold ms-1">@Model.Sensor.Latitude</h6>°</div>
                    <div class="title">Long: <h6 class="d-inline-block fw-bold ms-1">@Model.Sensor.Longitude</h6> °</div>
                </div>

            </div>
            <div class="col-xl-9 d-flex flex-column">
                <div id="npkChart" class="chart-wrapper"></div>
                <div id="humidittyChart"></div>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        var npkOptions = {
            chart: {
                type: 'bar',
                height: 250
            },
            plotOptions: {
                bar: {
                    horizontal: true,
                    barHeight: '30%',            
                }
            },
            colors: ['#ffffff'],
            fill: {
                type: 'gradient',
                gradient: {
                    shade: '#fff',
                    type: 'horizontal',
                    shadeIntensity: 0.5,
                    gradientToColors: [' #ddead4'], 
                    inverseColors: false,
                    opacityFrom: 1,
                    opacityTo: 1,
                    stops: [0, 100]
                }
            },
            grid: {
                show: false,
            },
            dataLabels: {
                enabled: true,
                formatter: function (val) {
                    return val;
                },
                style: {
                    colors: ['#000000'] 
                }

            },
            xaxis: {
                max: 1000
            },
            states: {
                hover: {
                    filter: {
                        type: 'none' // tắt filter khi hover
                    }
                },
                active: {
                    filter: {
                        type: 'none' // tắt filter khi click
                    }
                }
            },
            tooltip: {
                enabled: false // tắt tooltip khi hover
            },
            series: [{
                data: [
                    {
                        x: 'N',
                        y: @Model.N
                            },
                    {
                        x: 'P',
                        y: @Model.P
                            },
                    {
                        x: 'K',
                        y: @Model.K
                            }
                ]
            }]
        };

        var npkChart = new ApexCharts(document.querySelector("#npkChart"), npkOptions);
        npkChart.render();


        var humiditties = @Html.Raw(TempData["Humiditties"] ?? "[]");
        var humidittyOptions = {
            chart: {
                type: 'line',
                height: 180,
                toolbar: { show: false }
            },
            title: {
                text: "Humiditty range",
                align: "left",
                margin: 0,
                offsetX: 0,
                style: {
                    fontSize: "14px",
                    fontWeight: 300,
                    color: "#333",
                },

               
            },
            stroke: {
                curve: 'smooth',
                width: 2
            },
            colors: ['#004d00'], 
            series: [
                {
                    name: 'Humidity',
                    data: humiditties 
                }
            ],
            grid: {
                show: false  
            }, 
            xaxis: {
                labels: { show: false },  
                axisBorder: { show: false }, 
                axisTicks: { show: false },  
                title: { text: undefined },
                crosshairs: {
                    show: false   
                },
                tooltip: {
                    enabled: false 
                }
            },
            yaxis: {
                min: 0,
                max: 60,
                
            },
            tooltip: {
                enabled: true
            }
        };


        var humidittyChart = new ApexCharts(document.querySelector("#humidittyChart"), humidittyOptions);
        humidittyChart.render();
    </script>
}